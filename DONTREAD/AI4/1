<!-- File: docs/proposals/hybrid-multi-signal-router-h3.md -->

### Hybrid Multi-Signal Router (H3)

- **Goals**
  - Combine signals: capability (C1), domain (D1), lifecycle (plan→release), stack profile, and evidence from repo.
  - Produce robust routing with confidence scoring and reasons.

- **Assumptions**
  - Repo artifacts (e.g., `openapi.yaml`, `package.json`) inform stack and lifecycle.

- **Alternatives**
  - Pure C1 or pure D1.

- **Risks**
  - Complexity; harder to debug. Requires observability of route decisions.

- **Dependencies**
  - Context Discovery rule; domain detector; stack profiler.

### Signals and Weights
- Capability intent (0.35), Domain (0.25), Lifecycle verbs (0.15), Stack profile (0.15), Evidence files (0.10). Tunable.

### Router Logic (H3)
- Extract features from message + repo snapshot.
- Score each rule bundle; attach top route + overlays.
- Emit "why" with contributing signals, confidence.

### Trigger ↔ Rule(s) ↔ Files/Outputs (examples)
| Trigger (composite) | Rule(s) | Files/Outputs |
|---|---|---|
| web+foundation | UI Foundation, `F3` | tokens, grid |
| backend+contracts | `F4` | ADRs, OpenAPI |
| data+quality | `F5` | schema thresholds |
| infra+release | `F9` | rollout plan, runbook |
| any+security | F8 overlay | threat model, SBOM |

### Backward-Compat
| Old Trigger | New Composite Trigger(s) | Affected Rules |
|---|---|---|
| foundation | web+foundation | UI foundation rules |
| release | infra/backend+release | `F9` |
| security | any+security | F8 overlay |

### Migration Plan
- Mirror mode: run H3 alongside current router; log deltas.
- Confidence thresholds + manual override.
- Turn on progressively per domain.

### Example Messages
- "Fix CLS on product page" → web+interaction+perf → UI Interaction + perf targets.
- "Version API to v2.0 and define rollback" → backend+contracts+release → `F4` + `F9`.

### Success Metrics
- Route disagreement with SME review < 2%.
- Mean route latency stable within 5%.

### Next Steps
- Implement feature extractors; add decision logs; create dashboards.